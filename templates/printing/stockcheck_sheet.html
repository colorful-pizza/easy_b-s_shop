<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>库存盘点单</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, "Noto Sans", "PingFang SC", "Microsoft Yahei",
          sans-serif;
        color: #222;
      }
      .container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
      }
      h1 {
        font-size: 22px;
        margin: 0 0 10px;
        text-align: center;
      }
      .meta {
        display: flex;
        justify-content: space-between;
        font-size: 13px;
        color: #555;
        margin-bottom: 12px;
      }
      .box {
        border: 1px solid #ddd;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 16px;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        font-size: 14px;
      }
      .row > div {
        flex: 1 1 260px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
      }
      th,
      td {
        border: 1px solid #e5e5e5;
        padding: 6px 8px;
        text-align: left;
      }
      thead th {
        background: #f7f7f7;
      }
      .text-right {
        text-align: right;
      }
      .muted {
        color: #666;
      }
      .small {
        font-size: 12px;
      }
      @media print {
        .no-print {
          display: none !important;
        }
        body {
          margin: 0;
        }
        .container {
          padding: 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="no-print" style="text-align: right; margin-bottom: 8px">
        <button onclick="window.print()">打印</button>
        <button onclick="window.close()">关闭</button>
      </div>
      <h1>库存盘点单</h1>
      <div class="meta">
        <div>打印时间：<span id="now"></span></div>
        <div class="muted small">实际数列为空，线下填写后再录入系统</div>
      </div>

      <div class="box">
        <div class="row">
          <div><strong>盘点单号：</strong>{{ check.check_no }}</div>
          <div><strong>盘点日期：</strong>{{ check.check_date }}</div>
          <div>
            <strong>状态：</strong>{{ '进行中' if check.status == 'ongoing' else
            '已完成' }}
          </div>
          <div><strong>盘点人：</strong>{{ check.user_name or '-' }}</div>
        </div>
      </div>

      <div class="box">
        <table>
          <thead>
            <tr>
              <th style="width: 120px">商品编码</th>
              <th>商品名称</th>
              <th style="width: 70px">单位</th>
              <th style="width: 90px" class="text-right">账面数</th>
              <th style="width: 120px" class="text-right">实际数</th>
              <th style="width: 120px">备注</th>
            </tr>
          </thead>
          <tbody>
            {% if details and details|length > 0 %} {% for d in details %}
            <tr>
              <td>{{ d.code or '-' }}</td>
              <td>{{ d.product_name }}</td>
              <td>{{ d.unit or '' }}</td>
              <td class="text-right">{{ d.book_quantity }}</td>
              <td class="text-right">&nbsp;</td>
              <td></td>
            </tr>
            {% endfor %} {% else %}
            <tr>
              <td colspan="6" class="text-right">暂无明细</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <script>
      document.getElementById("now").textContent = new Date().toLocaleString();
      setTimeout(() => window.print(), 150);
    </script>
  </body>
</html>
